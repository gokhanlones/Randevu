<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>İşletme Ayarları - Stilix</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#f5f5f5;}

.navbar{
height:60px;
background:linear-gradient(135deg,#667eea,#764ba2);
display:flex;align-items:center;
padding:0 20px;color:#fff;gap:15px;
}
.navbar i{cursor:pointer}

.main{padding:25px;display:flex;justify-content:center;}
.container{width:100%;max-width:950px;}

.accordion-card{
background:#fff;
border-radius:20px;
margin-bottom:20px;
overflow:hidden;
box-shadow:0 8px 25px rgba(0,0,0,0.06);
}

.accordion-header{
padding:20px;
font-weight:600;
display:flex;
justify-content:space-between;
align-items:center;
cursor:pointer;
background:#f9f9f9;
}

.accordion-header i{transition:0.3s;}
.accordion-header.active i{transform:rotate(180deg);}

.accordion-content{
max-height:0;
overflow:hidden;
transition:0.4s;
padding:0 20px;
}

.accordion-content.active{
max-height:3000px;
padding:20px;
}

.grid2{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
}
@media (max-width:820px){
.grid2{grid-template-columns:1fr;}
}

.input-group{margin-bottom:12px;}
.input-group label{display:block;font-size:0.9rem;margin-bottom:4px;color:#333;}

.input-group input,
.input-group select{
width:100%;
padding:10px;
border-radius:10px;
border:2px solid #ddd;
outline:none;
}
.input-group input:focus,
.input-group select:focus{border-color:#667eea;}

.service-card{
padding:15px 0;
border-bottom:1px solid #eee;
}
.service-title{
font-weight:600;
margin-bottom:8px;
font-size:0.95rem;
}

.service-inputs{
display:grid;
grid-template-columns:1fr 1fr;
gap:10px;
}

@media (max-width:480px){
.service-inputs{
grid-template-columns:1fr;
}
}

.service-input-wrapper{
position:relative;
width:100%;
}

.service-input-wrapper i{
position:absolute;
left:10px;
top:50%;
transform:translateY(-50%);
font-size:0.8rem;
color:#777;
}

.service-input-wrapper input{
width:100%;
padding:10px 10px 10px 30px;
border-radius:10px;
border:2px solid #ddd;
font-size:0.9rem;
}

.save-btn{
width:100%;
padding:18px;
border:none;
border-radius:14px;
background:linear-gradient(135deg,#4caf50,#66bb6a);
color:#fff;
font-weight:700;
font-size:1rem;
cursor:pointer;
}

.toast{
position:fixed;
left:50%;
bottom:22px;
transform:translateX(-50%);
background:#111;
color:#fff;
padding:10px 14px;
border-radius:12px;
display:none;
z-index:9999;
}
</style>
</head>

<body>

<div class="navbar">
<i class="fas fa-arrow-left" onclick="goBack()"></i>
İşletme Ayarları
</div>

<div class="main">
<div class="container">

<div class="accordion-card">
<div class="accordion-header" onclick="toggleSection('businessSection')">
<span>İşletme Bilgileri</span>
<i class="fas fa-chevron-down"></i>
</div>
<div class="accordion-content" id="businessSection">

<div class="input-group">
<label>Şube Adı</label>
<input type="text" id="sube_adi">
</div>

<div class="grid2">
<div class="input-group"><label>Ülke</label><select id="ulke"><option value="Türkiye">Türkiye</option></select></div>
<div class="input-group"><label>İl</label><select id="il"></select></div>
<div class="input-group"><label>İlçe</label><select id="ilce"></select></div>
<div class="input-group"><label>Mahalle</label><select id="mahalle"></select></div>
<div class="input-group"><label>Cadde</label><input type="text" id="cadde"></div>
<div class="input-group"><label>Sokak</label><input type="text" id="sokak"></div>
<div class="input-group"><label>Bina No</label><input type="text" id="bina_no"></div>
<div class="input-group"><label>Bina Adı</label><input type="text" id="bina_adi"></div>
<div class="input-group"><label>Kat</label><input type="text" id="kat"></div>
<div class="input-group"><label>Daire</label><input type="text" id="daire"></div>
</div>

</div>
</div>

<div class="accordion-card">
<div class="accordion-header" onclick="toggleSection('servicesSection')">
<span>Hizmetler</span>
<i class="fas fa-chevron-down"></i>
</div>
<div class="accordion-content" id="servicesSection">
<div id="service-container">Yükleniyor...</div>
</div>
</div>

<button class="save-btn" onclick="saveAll()">Kaydet</button>

</div>
</div>

<div class="toast" id="toast"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxfySiI1ZLGBZY0YaifuAXAMcoYpO_UPj6nueQSvEoFIHQSsNSw75-X5BFdiuMG-x5V/exec";

function toggleSection(id){
const contents=document.querySelectorAll(".accordion-content");
const headers=document.querySelectorAll(".accordion-header");
const target=document.getElementById(id);
const header=target.previousElementSibling;
const open=target.classList.contains("active");

contents.forEach(c=>c.classList.remove("active"));
headers.forEach(h=>h.classList.remove("active"));

if(!open){
target.classList.add("active");
header.classList.add("active");
}
}

function goBack(){window.location.href="branch-edit.html";}

function toast(msg){
const t=document.getElementById("toast");
t.textContent=msg;
t.style.display="block";
setTimeout(()=>t.style.display="none",2500);
}

function jsonp(action,params={}){
return new Promise((resolve, reject)=>{
const cb="cb_"+Date.now();
window[cb]=d=>{
delete window[cb];
if(document.body.contains(s)) document.body.removeChild(s);
resolve(d);
};
const q=new URLSearchParams({action,callback:cb,...params}).toString();
const s=document.createElement("script");
s.src=API+"?"+q;
s.onerror=()=>{delete window[cb];reject(new Error('API cagrisi basarisiz'));};
document.body.appendChild(s);
});
}

function getToken(){return localStorage.getItem("stilix_token");}
function getSubeId(){return localStorage.getItem("selectedBranch");}

async function loadServices(){
const container=document.getElementById("service-container");
container.innerHTML="Yükleniyor...";

try {
const masterRes = await jsonp("getMasterServices");

if(!masterRes.services){
container.innerHTML="Hizmet yüklenemedi";
return;
}

container.innerHTML="";
masterRes.services.forEach(s=>{
const div=document.createElement("div");
div.className="service-card";
div.innerHTML=`
<div class="service-title">${s.hizmet}</div>
<div class="service-inputs">
<div class="service-input-wrapper">
<i class="fas fa-clock"></i>
<input type="number" data-id="${s.hizmetId}" class="sure" value="0">
</div>
<div class="service-input-wrapper">
<i class="fas fa-lira-sign"></i>
<input type="number" data-id="${s.hizmetId}" class="fiyat" value="0">
</div>
</div>
`;
container.appendChild(div);
});
} catch(err){
container.innerHTML="Hata: " + err.message;
}
}

document.addEventListener("DOMContentLoaded",async()=>{
await loadServices();
});
</script>

</body>
</html>
