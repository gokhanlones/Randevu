<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Stilix</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:#f5f5f5;min-height:100vh;}

/* NAVBAR */
.navbar{
position:fixed;top:0;left:0;right:0;height:60px;
background:linear-gradient(135deg,#667eea,#764ba2);
display:flex;align-items:center;justify-content:space-between;
padding:0 20px;z-index:1000;color:#fff;
}
.nav-left{display:flex;align-items:center;gap:15px;}
.hamburger{background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;}
.nav-logo{font-weight:bold;font-size:1.3rem;display:flex;align-items:center;gap:8px;}
.nav-logo i{color:#ff6b9d;}
.nav-right{font-weight:500;}

/* SIDEBAR */
.sidebar{
position:fixed;top:0;left:-320px;width:320px;height:100%;
background:#fff;z-index:999;transition:0.3s;overflow-y:auto;
box-shadow:5px 0 30px rgba(0,0,0,0.2);
}
.sidebar.active{left:0;}

.sidebar-overlay{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.5);opacity:0;visibility:hidden;transition:0.3s;z-index:998;
}
.sidebar-overlay.active{opacity:1;visibility:visible;}

.sidebar-header{
background:linear-gradient(135deg,#667eea,#764ba2);
color:#fff;padding:25px;text-align:center;
}
.user-avatar{width:70px;height:70px;border-radius:50%;background:rgba(255,255,255,0.2);
display:flex;align-items:center;justify-content:center;margin:0 auto 10px;font-size:2rem;}

.add-branch-btn{
margin:15px;padding:12px;border:none;border-radius:10px;
background:linear-gradient(135deg,#4caf50,#66bb6a);
color:#fff;font-weight:600;cursor:pointer;
}

.branch-list{padding:15px;}
.branch-list h4{color:#666;font-size:0.8rem;margin-bottom:10px;}

/* ‚úÖ KART ≈ûUBE TASARIMI */
.branch-card{
background:#fff;
padding:14px 14px;
border-radius:12px;
margin-bottom:10px;
cursor:pointer;
transition:0.2s;
border:2px solid transparent;
box-shadow:0 4px 10px rgba(0,0,0,0.05);
}
.branch-card:hover{
transform:translateY(-2px);
box-shadow:0 6px 14px rgba(0,0,0,0.10);
}
.branch-card.active{
border-color:#667eea;
background:#f3f4ff;
}
.branch-title{
font-weight:700;
color:#333;
margin-bottom:6px;
display:flex;
align-items:center;
gap:10px;
}
.branch-badge{
width:34px;height:34px;border-radius:10px;
background:linear-gradient(135deg,#ff6b9d,#ff8fab);
display:flex;align-items:center;justify-content:center;
color:#fff;
flex:0 0 auto;
}
.branch-location{
font-size:0.85rem;color:#666;
}

/* FOOTER */
.sidebar-footer{padding:15px;border-top:1px solid #eee;}
.menu-item{display:flex;align-items:center;gap:10px;padding:10px;text-decoration:none;color:#666;border-radius:6px;}
.menu-item:hover{background:#f5f5f5;}

.main-content{margin-top:60px;padding:30px;}
.welcome-card{background:#fff;border-radius:15px;padding:40px;text-align:center;}

/* ‚úÖ ≈ûube se√ßilince g√∂r√ºnecek butonlar */
.branch-actions{
display:flex;
gap:15px;
justify-content:center;
margin-top:10px;
}
.action-btn{
flex:1;
max-width:220px;
padding:16px;
border:none;
border-radius:14px;
font-size:1rem;
font-weight:700;
cursor:pointer;
transition:0.2s;
display:flex;
align-items:center;
justify-content:center;
gap:10px;
color:#fff;
}
.btn-edit{background:linear-gradient(135deg,#ff9800,#ffb74d);}
.btn-edit:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(255,152,0,0.30);}
.btn-dash{background:linear-gradient(135deg,#667eea,#764ba2);}
.btn-dash:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(102,126,234,0.30);}
</style>
</head>

<body>

<nav class="navbar">
<div class="nav-left">
<button class="hamburger" onclick="toggleSidebar()">
<i class="fas fa-bars"></i>
</button>
<div class="nav-logo"><i class="fas fa-cut"></i>Stilix</div>
</div>
<div class="nav-right" id="selected-branch-name">≈ûube Se√ßilmedi</div>
</nav>

<div class="sidebar-overlay" onclick="toggleSidebar()"></div>

<aside class="sidebar">
<div class="sidebar-header">
<div class="user-avatar"><i class="fas fa-user"></i></div>
<div id="user-name"></div>
<div id="user-email"></div>
</div>

<button class="add-branch-btn" onclick="openAddBranch()">
<i class="fas fa-plus"></i> ≈ûube Ekle
</button>

<div class="branch-list">
<h4>≈ûubelerim</h4>
<div id="branch-container"></div>
</div>

<div class="sidebar-footer">
<a href="#" class="menu-item" onclick="logout()">
<i class="fas fa-sign-out-alt"></i> √áƒ±kƒ±≈ü Yap
</a>
</div>
</aside>

<main class="main-content">
<!-- ‚úÖ Bu kart beyaz kalacak, i√ßerik ≈üube se√ßimine g√∂re deƒüi≈üecek -->
<div class="welcome-card" id="main-card">
    <div id="pre-branch">
        <h2>Ho≈ü Geldiniz üëã</h2>
        <p>Sol men√ºden ≈üube se√ßebilir veya yeni ≈üube ekleyebilirsiniz.</p>
    </div>

    <div id="after-branch" style="display:none;">
        <div class="branch-actions">
            <button class="action-btn btn-edit" onclick="editBranch()">
                <i class="fas fa-pen"></i> D√ºzenle
            </button>
            <button class="action-btn btn-dash" onclick="openBranchDashboard()">
                <i class="fas fa-chart-line"></i> Dashboard
            </button>
        </div>
    </div>
</div>
</main>

<script>

const API = "https://script.google.com/macros/s/AKfycbwDCF3GWF-HuqqRPG6rTOvZRh1WXjdKl8mQBu2-OOThaSri4hUWFqhLCTHeVrahbWpA/exec";

function jsonp(action, params = {}) {
return new Promise(resolve => {
const cb = "cb_" + Date.now();
window[cb] = function(data){
delete window[cb];
document.body.removeChild(script);
resolve(data);
};
const query = new URLSearchParams({action,callback:cb,...params}).toString();
const script = document.createElement("script");
script.src = API + "?" + query;
document.body.appendChild(script);
});
}

function showBranchActions(){
document.getElementById("pre-branch").style.display="none";
document.getElementById("after-branch").style.display="block";
}

window.onload = async function(){

const user = JSON.parse(localStorage.getItem("stilix_user") || sessionStorage.getItem("stilix_user"));
const token = localStorage.getItem("stilix_token") || sessionStorage.getItem("stilix_token");

if(!user || !token){
window.location.href="business-login.html";
return;
}

document.getElementById("user-name").textContent=user.ad+" "+user.soyad;
document.getElementById("user-email").textContent=user.email;

loadBranches(token);
};

async function loadBranches(token){

const container=document.getElementById("branch-container");
container.innerHTML="Y√ºkleniyor...";

const data=await jsonp("getBranches",{token});
container.innerHTML="";

if(!data.success || !data.branches || data.branches.length===0){
container.innerHTML="<div style='padding:10px;color:#777;'>Hen√ºz ≈üube eklenmedi</div>";
return;
}

const saved=localStorage.getItem("selectedBranch");

data.branches.forEach(branch=>{

const card=document.createElement("div");
card.className="branch-card";
card.dataset.id=branch.subeId;

card.innerHTML=`
    <div class="branch-title">
        <div class="branch-badge"><i class="fas fa-store"></i></div>
        <div>${branch.subeAdi}</div>
    </div>
    <div class="branch-location">${branch.il}, ${branch.ilce}, ${branch.mahalle}</div>
`;

if(saved===branch.subeId){
card.classList.add("active");
document.getElementById("selected-branch-name").textContent=branch.subeAdi;
showBranchActions();
}

card.onclick=function(){
document.querySelectorAll(".branch-card").forEach(i=>i.classList.remove("active"));
card.classList.add("active");

localStorage.setItem("selectedBranch", branch.subeId);
localStorage.setItem("selectedBranchName", branch.subeAdi);

document.getElementById("selected-branch-name").textContent=branch.subeAdi;

showBranchActions();
toggleSidebar();
};

container.appendChild(card);
});
}

function toggleSidebar(){
document.querySelector(".sidebar").classList.toggle("active");
document.querySelector(".sidebar-overlay").classList.toggle("active");
}

function openAddBranch(){
window.location.href="add-branch.html";
}

function logout(){
localStorage.clear();
sessionStorage.clear();
window.location.href="business-login.html";
}

function editBranch(){
    window.location.href = "branch-edit.html";
}

function openBranchDashboard(){
const id = localStorage.getItem("selectedBranch");
alert("Dashboard (≈ûube ID): " + id);
}

</script>

</body>
</html>
