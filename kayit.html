<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İşletmeci Kayıt - Flow Randevu</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root {
    --primary: #4F46E5;
    --primary-hover: #4338CA;
    --light-bg: #F3F4F6;
    --card-bg: #FFFFFF;
    --text-dark: #1F2937;
    --border: #E5E7EB;
    --success: #10B981;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family:'Segoe UI', sans-serif;
    background:var(--light-bg);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.container {
    width:100%;
    max-width:480px;
}

.card {
    background:var(--card-bg);
    padding:35px 30px;
    border-radius:16px;
    box-shadow:0 10px 40px rgba(0,0,0,0.1);
}

.card h2 {
    text-align:center;
    margin-bottom:10px;
    color:var(--text-dark);
}

.subtitle {
    text-align:center;
    color:#6B7280;
    font-size:14px;
    margin-bottom:25px;
}

.input-group {
    margin-bottom:16px;
}

.input-group label {
    display:block;
    margin-bottom:6px;
    font-size:13px;
    color:var(--text-dark);
    font-weight:500;
}

.input-group input {
    width:100%;
    padding:12px 14px;
    border-radius:8px;
    border:1px solid var(--border);
    font-size:14px;
    transition:0.2s;
}

.input-group input:focus {
    outline:none;
    border-color:var(--primary);
    box-shadow:0 0 0 3px rgba(79,70,229,0.1);
}

.code-input {
    text-align:center !important;
    letter-spacing:10px !important;
    font-size:28px !important;
    font-weight:bold !important;
}

/* Sözleşme Checkbox */
.checkbox-group {
    display:flex;
    align-items:flex-start;
    gap:10px;
    margin:20px 0;
    padding:15px;
    background:#F9FAFB;
    border-radius:8px;
    border:1px solid var(--border);
}

.checkbox-group input[type="checkbox"] {
    width:18px;
    height:18px;
    margin-top:2px;
    accent-color:var(--primary);
    cursor:pointer;
}

.checkbox-group label {
    font-size:13px;
    color:#4B5563;
    line-height:1.5;
    cursor:pointer;
}

.checkbox-group a {
    color:var(--primary);
    text-decoration:underline;
    font-weight:500;
}

.save-btn {
    width:100%;
    padding:14px;
    border:none;
    border-radius:8px;
    background:var(--primary);
    color:white;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    transition:0.2s;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:8px;
}

.save-btn:hover:not(:disabled) {
    background:var(--primary-hover);
}

.save-btn:disabled {
    opacity:0.6;
    cursor:not-allowed;
}

.back {
    text-align:center;
    margin-top:20px;
    font-size:14px;
}

.back a {
    color:var(--primary);
    text-decoration:none;
    cursor:pointer;
}

#result {
    margin-top:15px;
    padding:12px;
    border-radius:8px;
    text-align:center;
    display:none;
    font-size:14px;
}

.success {
    background:#d1fae5;
    color:#065f46;
    border:1px solid #a7f3d0;
}

.error {
    background:#fee2e2;
    color:#991b1b;
    border:1px solid #fecaca;
}

.hidden {
    display:none !important;
}

.step {
    display:none;
}

.step.active {
    display:block;
}

.resend {
    text-align:center;
    margin-top:15px;
    font-size:13px;
    color:#6B7280;
}

.resend a {
    color:var(--primary);
    cursor:pointer;
    text-decoration:underline;
}

/* Sözleşme Modal */
.modal-overlay {
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:1000;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.modal-overlay.active {
    display:flex;
}

.modal {
    background:white;
    width:100%;
    max-width:600px;
    max-height:80vh;
    border-radius:12px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
}

.modal-header {
    padding:20px;
    border-bottom:1px solid var(--border);
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.modal-header h3 {
    color:var(--text-dark);
    font-size:18px;
}

.modal-close {
    background:none;
    border:none;
    font-size:28px;
    cursor:pointer;
    color:#6B7280;
    line-height:1;
}

.modal-close:hover {
    color:var(--text-dark);
}

.modal-body {
    padding:20px;
    overflow-y:auto;
    flex:1;
    line-height:1.6;
    color:#4B5563;
    font-size:14px;
}

.modal-body h4 {
    color:var(--text-dark);
    margin:20px 0 10px 0;
    font-size:15px;
}

.modal-body h4:first-child {
    margin-top:0;
}

.modal-body p {
    margin-bottom:10px;
}

.modal-footer {
    padding:20px;
    border-top:1px solid var(--border);
    display:flex;
    justify-content:flex-end;
    gap:10px;
}

.modal-btn {
    padding:10px 20px;
    border-radius:6px;
    border:none;
    cursor:pointer;
    font-size:14px;
    font-weight:500;
}

.modal-btn.secondary {
    background:#F3F4F6;
    color:#4B5563;
}

.modal-btn.secondary:hover {
    background:#E5E7EB;
}

.modal-btn.primary {
    background:var(--primary);
    color:white;
}

.modal-btn.primary:hover {
    background:var(--primary-hover);
}
</style>
</head>

<body>

<!-- Sözleşme Modal -->
<div class="modal-overlay" id="sozlesmeModal">
    <div class="modal">
        <div class="modal-header">
            <h3><i class="fa-solid fa-file-contract"></i> Kullanım Sözleşmesi</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <h4>1. Hizmet Kapsamı</h4>
            <p>Flow Randevu sistemi, işletmelerin randevu yönetimini dijital ortamda gerçekleştirmesini sağlayan bir SaaS platformudur.</p>
            
            <h4>2. Kullanıcı Yükümlülükleri</h4>
            <p>Kullanıcı, sisteme doğru ve güncel bilgiler girmekle yükümlüdür. Yanlış bilgi girilmesinden doğan sorumluluk kullanıcıya aittir.</p>
            
            <h4>3. Veri Güvenliği</h4>
            <p>Kullanıcı bilgileri SHA-256 algoritması ile şifrelenerek saklanır. Cihaz bilgileri (IP, tarayıcı, işletim sistemi) sadece güvenlik amaçlı kaydedilir.</p>
            
            <h4>4. Gizlilik</h4>
            <p>Kişisel verileriniz 6698 sayılı KVKK kapsamında korunmaktadır. Verileriniz üçüncü taraflarla paylaşılmaz.</p>
            
            <h4>5. Hizmet Şartları</h4>
            <p>Sistem, bakım ve güncelleme çalışmaları nedeniyle belirli dönemlerde kullanılamayabilir. Kullanıcı, sistemin %99.9 uptime garantisi ile çalıştığını kabul eder.</p>
            
            <h4>6. Üyelik İptali</h4>
            <p>Kullanıcı, istediği zaman hesabını silebilir. Silinen hesapların verileri 30 gün içinde sistemden tamamen kaldırılır.</p>
        </div>
        <div class="modal-footer">
            <button class="modal-btn secondary" onclick="closeModal()">Kapat</button>
            <button class="modal-btn primary" onclick="onaylaSozlesme()">
                <i class="fa-solid fa-check"></i> Okudum, Onaylıyorum
            </button>
        </div>
    </div>
</div>

<div class="container">
<div class="card">

    <!-- ADIM 1: Kayıt Formu -->
    <div id="step1" class="step active">
        <h2>İşletmeci Kayıt</h2>
        <p class="subtitle">Flow Randevu sistemine üye olun</p>

        <form id="registerForm" onsubmit="return handleRegister();">
            <div class="input-group">
                <label>Ad</label>
                <input type="text" id="firstName" placeholder="Adınız" required>
            </div>

            <div class="input-group">
                <label>Soyad</label>
                <input type="text" id="lastName" placeholder="Soyadınız" required>
            </div>

            <div class="input-group">
                <label>Email</label>
                <input type="email" id="email" placeholder="ornek@email.com" required>
            </div>

            <div class="input-group">
                <label>Email Tekrar</label>
                <input type="email" id="email2" placeholder="Email adresinizi tekrar girin" required>
            </div>

            <div class="input-group">
                <label>Telefon</label>
                <input type="tel" id="phone" placeholder="05xxxxxxxxx" required maxlength="11">
            </div>

            <!-- Sözleşme Onayı -->
            <div class="checkbox-group">
                <input type="checkbox" id="sozlesmeCheck" required>
                <label for="sozlesmeCheck">
                    <a href="#" onclick="openModal(); return false;">Kullanım sözleşmesini</a> okudum, onaylıyorum. 
                    Kişisel verilerimin işlenmesine izin veriyorum.
                </label>
            </div>

            <button type="submit" class="save-btn" id="registerBtn">
                <i class="fa-solid fa-arrow-right"></i> Devam Et
            </button>
        </form>

        <div class="back">
            <a href="index.html"><i class="fa-solid fa-arrow-left"></i> Ana sayfaya dön</a>
        </div>
    </div>

    <!-- ADIM 2: Kod Doğrulama -->
    <div id="step2" class="step">
        <h2>Kodu Doğrula</h2>
        <p class="subtitle"><span id="emailDisplay"></span> adresine 6 haneli kod gönderildi</p>

        <form id="verifyForm" onsubmit="return handleVerify();">
            <div class="input-group">
                <input type="text" id="verificationCode" class="code-input" placeholder="------" maxlength="6" required autocomplete="off" inputmode="numeric">
            </div>

            <button type="submit" class="save-btn" id="verifyBtn">
                <i class="fa-solid fa-check"></i> Doğrula
            </button>
        </form>

        <div class="resend">
            Kod gelmedi mi? <a onclick="resendCode()">Tekrar gönder</a>
        </div>

        <div class="back">
            <a onclick="goBack(1)"><i class="fa-solid fa-arrow-left"></i> Geri dön</a>
        </div>
    </div>

    <!-- ADIM 3: Şifre Oluştur -->
    <div id="step3" class="step">
        <h2>Şifre Belirle</h2>
        <p class="subtitle">Hesabınızı güvence altına alın</p>

        <form id="passwordForm" onsubmit="return handlePassword();">
            <div class="input-group">
                <label>Şifre</label>
                <input type="password" id="password" placeholder="En az 6 karakter" required minlength="6">
            </div>

            <div class="input-group">
                <label>Şifre Tekrar</label>
                <input type="password" id="password2" placeholder="Şifrenizi tekrar girin" required>
            </div>

            <button type="submit" class="save-btn" id="passwordBtn">
                <i class="fa-solid fa-lock"></i> Hesabı Oluştur
            </button>
        </form>

        <div class="back">
            <a onclick="goBack(2)"><i class="fa-solid fa-arrow-left"></i> Geri dön</a>
        </div>
    </div>

    <!-- ADIM 4: Başarılı -->
    <div id="step4" class="step">
        <div style="text-align:center;padding:30px 0;">
            <div style="width:80px;height:80px;background:#D1FAE5;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;">
                <i class="fa-solid fa-check" style="font-size:40px;color:var(--success);"></i>
            </div>
            <h2 style="color:var(--text-dark);margin-bottom:10px;">Kayıt Tamamlandı!</h2>
            <p style="color:#6B7280;font-size:14px;margin-bottom:25px;">Hesabınız başarıyla oluşturuldu.</p>
            <a href="giris.html" class="save-btn" style="text-decoration:none;">
                <i class="fa-solid fa-right-to-bracket"></i> Giriş Yap
            </a>
        </div>
    </div>

    <div id="result"></div>

</div>
</div>

<script>
// ========================================
// DEĞİŞKENLER
// ========================================
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzFDdJUleqANUc0bLI-_BV7pZ-o5nVC0TnxicooYbTT6P9tVX0GkB9aqSuGbJgNM6cH4g/exec';
let tempUserData = {};
let generatedCode = null;
let deviceInfo = {};

// ========================================
// CİHAZ BİLGİSİ TOPLA
// ========================================
function collectDeviceInfo() {
    const ua = navigator.userAgent;
    let os = "Bilinmiyor";
    let browser = "Bilinmiyor";
    
    if (ua.indexOf("Win") !== -1) os = "Windows";
    else if (ua.indexOf("Mac") !== -1) os = "MacOS";
    else if (ua.indexOf("Linux") !== -1) os = "Linux";
    else if (ua.indexOf("Android") !== -1) os = "Android";
    else if (ua.indexOf("like Mac") !== -1) os = "iOS";
    
    if (ua.indexOf("Chrome") !== -1) browser = "Chrome";
    else if (ua.indexOf("Safari") !== -1) browser = "Safari";
    else if (ua.indexOf("Firefox") !== -1) browser = "Firefox";
    else if (ua.indexOf("Edge") !== -1) browser = "Edge";
    
    deviceInfo = {
        browser: browser,
        os: os,
        screen: window.screen.width + "x" + window.screen.height
    };
}

window.onload = function() {
    collectDeviceInfo();
};

// ========================================
// MODAL İŞLEMLERİ
// ========================================
function openModal() {
    document.getElementById('sozlesmeModal').classList.add('active');
}

function closeModal() {
    document.getElementById('sozlesmeModal').classList.remove('active');
}

function onaylaSozlesme() {
    document.getElementById('sozlesmeCheck').checked = true;
    closeModal();
}

// Modal dışına tıklayınca kapat
document.getElementById('sozlesmeModal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

// ========================================
// ADIM YÖNETİMİ
// ========================================
function showStep(stepNumber) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step' + stepNumber).classList.add('active');
}

function showResult(msg, type) {
    const div = document.getElementById('result');
    div.textContent = msg;
    div.className = type;
    div.style.display = 'block';
    setTimeout(() => div.style.display = 'none', 5000);
}

// ========================================
// ADIM 1: KAYIT
// ========================================
function handleRegister() {
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const email = document.getElementById('email').value.trim();
    const email2 = document.getElementById('email2').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const sozlesme = document.getElementById('sozlesmeCheck').checked;

    if (email !== email2) {
        showResult('Email adresleri eşleşmiyor!', 'error');
        return false;
    }

    if (!/^05\d{9}$/.test(phone.replace(/\s/g,''))) {
        showResult('Telefon 05xxxxxxxxx formatında olmalı!', 'error');
        return false;
    }

    if (!sozlesme) {
        showResult('Kullanım sözleşmesini onaylamalısınız!', 'error');
        openModal();
        return false;
    }

    generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
    tempUserData = { firstName, lastName, email, phone };

    const btn = document.getElementById("registerBtn");
    btn.disabled = true;
    btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Gönderiliyor...`;

    const formData = new FormData();
    formData.append('action', 'sendVerificationCode');
    formData.append('email', email);
    formData.append('code', generatedCode);
    formData.append('firstName', firstName);
    formData.append('lastName', lastName);
    formData.append('phone', phone);

    fetch(SCRIPT_URL, { method: 'POST', body: formData }).catch(() => {});

    setTimeout(() => {
        document.getElementById('emailDisplay').textContent = email;
        showStep(2);
        document.getElementById('verificationCode').focus();
        btn.disabled = false;
        btn.innerHTML = `<i class="fa-solid fa-arrow-right"></i> Devam Et`;
    }, 2000);

    return false;
}

// ========================================
// ADIM 2: KOD DOĞRULA
// ========================================
function handleVerify() {
    const enteredCode = document.getElementById('verificationCode').value.trim();
    
    if (enteredCode !== generatedCode) {
        showResult('Kod hatalı! Lütfen tekrar deneyin.', 'error');
        return false;
    }

    showStep(3);
    return false;
}

// ========================================
// ADIM 3: ŞİFRE OLUŞTUR
// ========================================
function handlePassword() {
    const password = document.getElementById('password').value;
    const password2 = document.getElementById('password2').value;

    if (password !== password2) {
        showResult('Şifreler eşleşmiyor!', 'error');
        return false;
    }

    if (password.length < 6) {
        showResult('Şifre en az 6 karakter olmalı!', 'error');
        return false;
    }

    const btn = document.getElementById("passwordBtn");
    btn.disabled = true;
    btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Oluşturuluyor...`;

    const formData = new FormData();
    formData.append('action', 'completeRegisterWithCode');
    formData.append('firstName', tempUserData.firstName);
    formData.append('lastName', tempUserData.lastName);
    formData.append('email', tempUserData.email);
    formData.append('phone', tempUserData.phone);
    formData.append('password', password);
    formData.append('sozlesme', 'Evet');
    formData.append('browser', deviceInfo.browser);
    formData.append('os', deviceInfo.os);
    formData.append('screen', deviceInfo.screen);

    fetch(SCRIPT_URL, { method: 'POST', body: formData }).catch(() => {});

    setTimeout(() => {
        showStep(4);
    }, 2500);

    return false;
}

// ========================================
// YARDIMCI FONKSİYONLAR
// ========================================
function resendCode() {
    generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
    
    const formData = new FormData();
    formData.append('action', 'sendVerificationCode');
    formData.append('email', tempUserData.email);
    formData.append('code', generatedCode);
    formData.append('firstName', tempUserData.firstName);
    formData.append('lastName', tempUserData.lastName);
    formData.append('phone', tempUserData.phone);

    fetch(SCRIPT_URL, { method: 'POST', body: formData }).catch(() => {});
    showResult('Yeni kod gönderildi!', 'success');
}

function goBack(step) {
    showStep(step);
}
</script>

</body>
</html>
