<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Randevu AI</title>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<style>
:root{
--gold:#d4af37;
--gold-light:#f1d77a;
}

body{
margin:0;
font-family:Arial, sans-serif;
background:linear-gradient(160deg,#0d0d0d,#1a1a1a);
color:white;
padding:20px;
}

h1{
text-align:center;
color:var(--gold);
margin-bottom:30px;
}

.salon-card{
background:#181818;
padding:20px;
border-radius:15px;
margin-bottom:20px;
box-shadow:0 10px 30px rgba(0,0,0,0.5);
}

button{
width:100%;
padding:12px;
border:none;
border-radius:10px;
font-weight:bold;
background:linear-gradient(90deg,var(--gold),var(--gold-light));
cursor:pointer;
margin-top:10px;
}

.modal{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,0.85);
justify-content:center;
align-items:center;
}

.modal-content{
background:#181818;
padding:25px;
border-radius:15px;
width:90%;
max-width:400px;
}

input{
width:100%;
padding:10px;
margin-bottom:10px;
border-radius:8px;
border:none;
}

.close-btn{
background:#444;
color:white;
}
</style>
</head>

<body>

<h1>Kuaför Seç</h1>
<div id="salons"></div>

<div class="modal" id="bookingModal">
<div class="modal-content">
<h3 id="selectedSalonTitle"></h3>

<form id="bookingForm">
<input type="date" id="date" required>
<input type="time" id="time" required>
<input type="text" id="fullname" placeholder="Ad Soyad" required>
<input type="tel" id="phone" placeholder="Telefon" required>
<input type="email" id="email" placeholder="E-posta" required>

<button type="submit">Randevuyu Onayla</button>
<button type="button" class="close-btn" id="cancelBtn">İptal</button>
</form>

</div>
</div>

<script>

emailjs.init("bUqxAYFWuXWTy5nKT");

const SERVICE_ID = "service_8qoocwi";
const TEMPLATE_NOTIFY = "template_03obhwb";
const TEMPLATE_AUTO_REPLY = "template_08wro98";

/* ÇOKLU SALON + ADRES */

const salonList = [
{
name: "Urban Barber",
address: "Bağdat Caddesi No 25 Kadıköy İstanbul"
},
{
name: "Gold Salon",
address: "Barbaros Bulvarı No 10 Beşiktaş İstanbul"
},
{
name: "Royal Hair",
address: "Libadiye Caddesi No 5 Üsküdar İstanbul"
},
{
name: "Elite Barber",
address: "Mecidiyeköy Mahallesi No 8 Şişli İstanbul"
},
{
name: "Diamond Hair",
address: "Atatürk Caddesi No 15 Bakırköy İstanbul"
}
];

let selectedSalon = "";
const container = document.getElementById("salons");
const modal = document.getElementById("bookingModal");
const salonTitle = document.getElementById("selectedSalonTitle");
const form = document.getElementById("bookingForm");
const cancelBtn = document.getElementById("cancelBtn");

/* SALONLARI YAZ */

salonList.forEach(salon=>{
const card = document.createElement("div");
card.className = "salon-card";

card.innerHTML = `
<h3>${salon.name}</h3>
<button data-salon="${salon.name}">Randevu Al</button>
`;

container.appendChild(card);
});

/* MODAL */

container.addEventListener("click", function(e){
if(e.target.tagName === "BUTTON"){
selectedSalon = e.target.getAttribute("data-salon");
salonTitle.innerText = selectedSalon;
modal.style.display = "flex";
}
});

cancelBtn.addEventListener("click", function(){
modal.style.display = "none";
form.reset();
});

/* RANDEVU GÖNDER */

form.addEventListener("submit", async function(e){
e.preventDefault();

const date = document.getElementById("date").value;
const time = document.getElementById("time").value;
const name = document.getElementById("fullname").value;
const phone = document.getElementById("phone").value;
const email = document.getElementById("email").value;

const selectedSalonObj = salonList.find(s => s.name === selectedSalon);
const location = selectedSalonObj.address;

/* TAKVİM FORMAT */

const startDate = new Date(date + "T" + time);
const endDate = new Date(startDate.getTime() + 60 * 60000);

function formatDate(d){
return d.getFullYear().toString() +
("0"+(d.getMonth()+1)).slice(-2) +
("0"+d.getDate()).slice(-2) + "T" +
("0"+d.getHours()).slice(-2) +
("0"+d.getMinutes()).slice(-2) + "00";
}

const formattedStart = formatDate(startDate);
const formattedEnd = formatDate(endDate);

/* QR için benzersiz ID */
const bookingId = Date.now().toString();

const params = {
salon: selectedSalon,
date: date,
time: time,
name: name,
phone: phone,
email: email,
location: location,
calendar_start: formattedStart,
calendar_end: formattedEnd,
booking_id: bookingId
};

try {

await emailjs.send(SERVICE_ID, TEMPLATE_NOTIFY, params);
await emailjs.send(SERVICE_ID, TEMPLATE_AUTO_REPLY, params);

alert("Randevu başarıyla oluşturuldu.");
modal.style.display = "none";
form.reset();

}catch(error){
console.error(error);
alert("Mail gönderilirken hata oluştu!");
}

});

</script>

</body>
</html>
